include(CMakeFindDependencyMacro)

if(UNIX AND NOT APPLE)
    if(ANDROID)
        string(TOLOWER "${CMAKE_BUILD_TYPE}" BUILD_TYPE)
        if(${BUILD_TYPE} STREQUAL minsizerel)
            set(BUILD_TYPE release)
        endif()
        set(OPENSSL_FILENAME "openssl-${BUILD_TYPE}-@ANDROID_OPENSSL_VERSION@-@ANDROID_OPENSSL_BUILD_NUMBER@-Android-@CMAKE_ANDROID_ARCH_ABI@")
        set(OPENSSL_URL "http://static.realm.io/downloads/openssl/@ANDROID_OPENSSL_VERSION@/Android/@CMAKE_ANDROID_ARCH_ABI@/${OPENSSL_FILENAME}.tar.gz")

        message(STATUS "Downloading OpenSSL...")
        file(DOWNLOAD "${OPENSSL_URL}" "${CMAKE_BINARY_DIR}/${OPENSSL_FILENAME}.tar.gz")

        message(STATUS "Uncompressing OpenSSL...")
        execute_process(
            COMMAND ${CMAKE_COMMAND} -E tar xfz "${CMAKE_BINARY_DIR}/${OPENSSL_FILENAME}.tar.gz"
            WORKING_DIRECTORY "${CMAKE_BINARY_DIR}"
        )

        list(APPEND CMAKE_FIND_ROOT_PATH "${CMAKE_BINARY_DIR}/${OPENSSL_FILENAME}")
    endif()
    find_dependency(OpenSSL)
endif()

set(THREADS_PREFER_PTHREAD_FLAG ON)
find_dependency(Threads)

include("${CMAKE_CURRENT_LIST_DIR}/realmTargets.cmake")