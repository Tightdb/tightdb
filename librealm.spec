Name:           librealm
Version:        0.1.5
Release:        1%{?dist}
Summary:        Fast, embedded database

License:        Closed Beta
URL:            http://www.realm.com
Source0:        librealm-%{version}.tar.gz
BuildRoot:      %{_tmppath}/%{name}-%{version}-%{release}-root-%(%{__id_u} -n)

BuildRequires:  gcc-c++, chrpath
Requires:       glibc

# The tools (realmd and realm-import) depend on librealm.so
# and it must be excluded from the autogenerated list.
%global _privatelibs librealm[.]so.*
%global _privatelibs %{_privatelibs}|librealm-dbg[.]so.*
%global __provides_exclude ^(%{_privatelibs})$
%global __requires_exclude ^(%{_privatelibs})$


%description
Fast, embedded database

%package        devel
Summary:        Development files for %{name}
Requires:       %{name}%{?_isa} = %{version}-%{release}

%description    devel
The %{name}-devel package contains libraries and header files for
developing applications that use %{name}.


%prep
%setup -q


%build
sh ./build.sh config /usr
sh ./build.sh clean
sh ./build.sh build

%install
rm -rf $RPM_BUILD_ROOT
DESTDIR=$RPM_BUILD_ROOT sh build.sh install
chrpath --delete $RPM_BUILD_ROOT%{_libexecdir}/realmd-dbg
chrpath --delete $RPM_BUILD_ROOT%{_libexecdir}/realmd
chrpath --delete $RPM_BUILD_ROOT%{_bindir}/realm-import-dbg
chrpath --delete $RPM_BUILD_ROOT%{_bindir}/realm-import
chrpath --delete $RPM_BUILD_ROOT%{_bindir}/realm-config-dbg
chrpath --delete $RPM_BUILD_ROOT%{_bindir}/realm-config
find $RPM_BUILD_ROOT -name '*.la' -exec rm -f {} ';'

%clean
rm -rf $RPM_BUILD_ROOT

%post -p /sbin/ldconfig

%postun -p /sbin/ldconfig


%files
%defattr(-,root,root,-)
%doc README.md README.pdf
%{_libdir}/librealm.so
%{_libdir}/librealm-dbg.so.*
%{_libdir}/librealm-dbg.so
%{_libdir}/librealm.so.*
%{_libexecdir}/realmd
%{_libexecdir}/realmd-dbg
%{_bindir}/realm-import
%{_bindir}/realm-import-dbg

%files devel
%defattr(-,root,root,-)
%doc
%{_includedir}/*
%{_libdir}/*.a
%{_bindir}/realm-config
%{_bindir}/realm-config-dbg

%changelog
* Fri Jan  3 2014 Kenneth Geisshirt
- Tracking upstream release.
