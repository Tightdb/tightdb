name: Test SDKs
"on":
  pull_request:
    types:
    - opened
    - labeled
    - synchronize
jobs:
  update-realm-dotnet:
    runs-on: ubuntu-latest
    name: Update realm-dotnet
    if: ${{ contains(github.event.pull_request.labels.*.name, 'public-api') }}
    steps:
    - uses: actions/checkout@v2
    - name: Checkout realm-dotnet
      uses: actions/checkout@v2
      with:
        repository: realm/realm-dotnet
        path: integration/realm-dotnet
        submodules: recursive
    - name: Update submodule
      id: update-core
      run: |
        cd integration/realm-dotnet/wrappers/realm-core
        git remote set-branches --add 'origin' ${{ github.event.pull_request.head.ref }}
        git fetch origin ${{ github.event.pull_request.head.ref }}
        git checkout -t origin/${{ github.event.pull_request.head.ref }}
        core_sha=$(git rev-parse HEAD)
        echo '::set-output name=core-sha::$core_sha'
    - name: Create PR
      uses: peter-evans/create-pull-request@7380612b49221684fefa025244f2ef4008ae50ad
      if: ${{ steps.check-existing-pr.outputs.exists == '0' }}
      with:
        token: ${{ secrets.REALM_CI_PAT }}
        branch: ${{ github.event.pull_request.head.ref }}
        title: ${{ github.event.pull_request.title }}
        body: Pick up realm-core/#${{ github.event.pull_request.number }}
        delete-branch: true
        path: integration/realm-dotnet
        labels: public-api
        draft: true
